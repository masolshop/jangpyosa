# buyer01 시뮬레이션 검증 완료

## 📋 실제 데이터

**buyer01 장애인 구성:**
- 중증 여: 4명 (권서연, 오하은, 서시우, 한예준)
- 경증 남: 5명 (이지우, 임예준, 임지우, 강유진, 권준서)
- 경증 여: 2명 (홍유진, 김수아)
- **총 11명**

**인정수 계산:**
- 중증 여 4명 × 2배 (60시간 이상) = 8명
- 경증 7명 × 1배 = 7명
- **총 15명**

## 📊 시뮬레이션 검증

### 3월 (300명)
```
의무고용인원 (floor): floor(300 × 3.1%) = 9명
인정수: 15명
초과: 15 - 9 = +6명 ✅

장려금 지급기준 (ceil): ceil(300 × 3.1%) = 10명
장애인수: 11명
장려금 대상: 11 - 10 = 1명

선택: 권서연 (중증 여, 900,000원)
총 장려금: 900,000원
```

### 4월 (200명)
```
의무고용인원 (floor): floor(200 × 3.1%) = 6명
인정수: 15명
초과: 15 - 6 = +9명 ✅

장려금 지급기준 (ceil): ceil(200 × 3.1%) = 7명
장애인수: 11명
장려금 대상: 11 - 7 = 4명

선택 (상위 4명):
1. 권서연: 900,000원
2. 오하은: 817,344원 (60% 상한)
3. 서시우: 674,928원 (60% 상한)
4. 한예준: 495,360원 (60% 상한)

총 장려금: 2,887,632원
```

### 5월 (400명)
```
의무고용인원 (floor): floor(400 × 3.1%) = 12명
인정수: 15명
초과: 15 - 12 = +3명 ✅

장려금 지급기준 (ceil): ceil(400 × 3.1%) = 13명
장애인수: 11명
장려금 대상: 11 - 13 = -2 → 0명

총 장려금: 0원 ✅
```

## 🔍 DB vs 계산 비교

| 월 | 초과 (계산) | 초과 (DB) | 장려금 (계산) | 장려금 (DB) | 차이 |
|----|-------------|-----------|---------------|-------------|------|
| 3월 | **+6명** | 0.0 | 900,000원 | 600,000원 | 300,000원 |
| 4월 | **+9명** | 0.0 | 2,887,632원 | 1,900,000원 | 987,632원 |
| 5월 | **+3명** | 0.0 | 0원 | 0원 | 0원 |

## 🔴 문제점

### 1. surplusCount가 0.0으로 저장됨
- **원인**: `employees.ts` Line 307, 322에서 하드코딩
- **수정**: `surplusCount: result.surplusCount`로 변경
- **상태**: ✅ 수정 완료, 배포 완료

### 2. 장려금 계산값 차이
- **DB 저장값**: 600,000원 (3월), 1,900,000원 (4월)
- **정확한 계산**: 900,000원 (3월), 2,887,632원 (4월)
- **원인**: 이전 계산 로직(모든 직원 합산)으로 저장된 데이터

## ✅ 해결 방안

1. **surplusCount 수정 완료**
   - 코드 수정: `result.surplusCount` 사용
   - 배포 완료: PM2 restart #30

2. **기존 데이터 재계산 필요**
   - 새로운 계산 로직: 초과 인원만 장려금 지급
   - 장려금 높은 순 정렬 후 상위 N명 선택
   - 60% 상한 + 근로시간 비율 적용

3. **재계산 후 예상 결과**
   - 3월: 초과 +6명, 장려금 900,000원
   - 4월: 초과 +9명, 장려금 2,887,632원
   - 5월: 초과 +3명, 장려금 0원

## 🎯 결론

1. ✅ **계산 로직 정확함**
   - 부담금 초과 계산: recognizedCount - obligatedCount
   - 장려금 대상 계산: disabledCount - incentiveBaseCount
   - 장려금 지급: 상위 N명 선택

2. ✅ **코드 수정 완료**
   - surplusCount 하드코딩 제거
   - 장려금 초과 인원만 지급 로직 추가
   - 장려금 높은 순 정렬 추가

3. 🔄 **다음 작업**
   - buyer01 계정에서 3,4,5월 데이터 재입력 또는 재계산
   - 새로운 계산값 확인
   - UI에 정확한 초과 인원 표시 확인

---

**검증 완료일**: 2026-02-22
**검증자**: AI Assistant
**배포 상태**: ✅ 완료 (PM2 #30)
