# ============================================
# Nginx Rate Limiting Configuration
# DDoS 방어를 위한 요청 제한 설정
# ============================================

# Zone 정의 - 요청 제한 메모리 영역
# limit_req_zone: IP 주소당 요청 제한
# limit_conn_zone: IP 주소당 동시 연결 제한

# API 엔드포인트 - 초당 10개 요청 제한 (60req/min)
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

# 일반 페이지 - 초당 30개 요청 제한 (1800req/min)
limit_req_zone $binary_remote_addr zone=page_limit:10m rate=30r/s;

# 로그인 엔드포인트 - 초당 2개 요청 제한 (브루트포스 방어)
limit_req_zone $binary_remote_addr zone=login_limit:10m rate=2r/s;

# 동시 연결 수 제한 - IP당 최대 20개 연결
limit_conn_zone $binary_remote_addr zone=conn_limit:10m;

# 요청 본문 크기 제한 (대용량 업로드 공격 방어)
client_max_body_size 10m;
client_body_buffer_size 128k;

# 타임아웃 설정 (슬로우 로리스 공격 방어)
client_body_timeout 10s;
client_header_timeout 10s;
send_timeout 10s;
keepalive_timeout 15s;

# 버퍼 크기 제한
client_body_buffer_size 1K;
client_header_buffer_size 1k;
large_client_header_buffers 2 1k;
