generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id           String   @id @default(cuid())
  phone        String   @unique // ğŸ†• í•¸ë“œí° ë²ˆí˜¸ê°€ ì•„ì´ë”” (ë¡œê·¸ì¸ìš©)
  email        String?  // ì´ë©”ì¼ì€ ì„ íƒì‚¬í•­
  passwordHash String
  name         String
  role         String   // "SUPER_ADMIN" | "AGENT" | "BUYER" | "SUPPLIER"
  
  // ğŸ†• ë§¤ë‹ˆì €(AGENT) ì „ìš© í•„ë“œ
  branchId     String?  // ì§€ì‚¬ ID (ë§¤ë‹ˆì €ë§Œ)
  branch       Branch?  @relation(fields: [branchId], references: [id])
  refCode      String?  @unique // ì¶”ì²œì½”ë“œ(ë§¤ë‹ˆì €ë§Œ)
  
  // ğŸ†• BUYER ì „ìš© í•„ë“œ
  companyType  String?  // "PRIVATE" | "GOVERNMENT" (BUYERë§Œ ì‚¬ìš©, ë¶€ë‹´ê¸ˆ ê³„ì‚° ë°©ì‹ êµ¬ë¶„)
  
  // ì¶”ì²œì¸ ê´€ê³„
  referredById String?  // ê°€ì… ì‹œ ì¶”ì²œì ID
  referredBy   User?    @relation("Referrals", fields: [referredById], references: [id])
  referrals    User[]   @relation("Referrals")
  
  company      Company?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// ğŸ†• ì§€ì‚¬(Branch) ëª¨ë¸
model Branch {
  id        String   @id @default(cuid())
  name      String   @unique // ì§€ì‚¬ëª… (ì˜ˆ: "ì„œìš¸ì§€ì‚¬", "ë¶€ì‚°ì§€ì‚¬")
  code      String   @unique // ì§€ì‚¬ ì½”ë“œ (ì˜ˆ: "SEOUL", "BUSAN")
  region    String?  // ì§€ì—­ (ì˜ˆ: "ì„œìš¸íŠ¹ë³„ì‹œ", "ë¶€ì‚°ê´‘ì—­ì‹œ")
  address   String?  // ì£¼ì†Œ
  phone     String?  // ëŒ€í‘œ ì „í™”ë²ˆí˜¸
  isActive  Boolean  @default(true)
  
  // ê´€ê³„
  agents    User[]   // ì†Œì† ë§¤ë‹ˆì €ë“¤
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Company {
  id          String      @id @default(cuid())
  name        String      // ìƒí˜¸ëª… (APICKì—ì„œ ìë™)
  bizNo       String      @unique // ì‚¬ì—…ìë²ˆí˜¸
  representative String?  // ğŸ†• ëŒ€í‘œìëª… (APICKì—ì„œ ìë™)
  type        String      // "SUPPLIER" | "BUYER"
  isVerified  Boolean     @default(false) // APICK ì¸ì¦ ì—¬ë¶€
  
  // ğŸ†• APICK ì¸ì¦ ë°ì´í„°
  apickData   String?     // APICK ì‘ë‹µ ì „ì²´ JSON (í•„ìš”ì‹œ ì°¸ì¡°)
  
  ownerUserId String      @unique
  ownerUser   User        @relation(fields: [ownerUserId], references: [id])

  supplierProfile SupplierProfile?
  buyerProfile    BuyerProfile?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// â­ 830ê°œ ì—…ì²´ ì—‘ì…€ ì—…ë¡œë“œìš© ë ˆì§€ìŠ¤íŠ¸ë¦¬ í…Œì´ë¸” (ìœ ì € ì—†ì´ë„ ì €ì¥ ê°€ëŠ¥)
model SupplierRegistry {
  id         String   @id @default(cuid())
  
  // ê¸°ë³¸ ì •ë³´ (ì—‘ì…€ì—ì„œ ê°€ì ¸ì˜´)
  certNo     String?  // ì¸ì¦ë²ˆí˜¸
  name       String   // ì‚¬ì—…ì²´ëª…
  bizNo      String   @unique // ì‚¬ì—…ìë²ˆí˜¸
  region     String?  // ê´€í• ì§€ì‚¬/ì†Œì¬ì§€
  representative String? // ëŒ€í‘œì
  address    String?  // ì†Œì¬ì§€
  certDate   String?  // ì¸ì¦ì¼ì
  contactTel String?  // ì „í™”ë²ˆí˜¸
  industry   String?  // ì—…ì¢… ë° ì£¼ìš”ìƒì‚°í’ˆ
  companyType String? // êµ¬ë¶„ (ì¼ë°˜/ìíšŒì‚¬)
  
  // âœ… Claim ê´€ê³„ ì„¤ì •
  claimedProfiles SupplierProfile[]
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model SupplierProfile {
  id          String @id @default(cuid())
  companyId   String @unique
  company     Company @relation(fields: [companyId], references: [id])

  region      String?
  industry    String?
  contactName String?
  contactTel  String?
  approved    Boolean @default(false)
  
  // ğŸ†• ë„ê¸‰ê³„ì•½ ì •ë³´
  contractDescription String? // ë„ê¸‰ê³„ì•½ ë°©ë²• ë° ì¡°ê±´ ì„¤ëª…
  minContractAmount   Int?    // ìµœì†Œ ë„ê¸‰ê³„ì•½ ê°€ëŠ¥ ê¸ˆì•¡ (KRW)
  maxContractAmount   Int?    // ìµœëŒ€ ë„ê¸‰ê³„ì•½ ê°€ëŠ¥ ê¸ˆì•¡ (KRW)
  
  // ğŸ†• ëŒ€í‘œ ì´ë¯¸ì§€ (ìµœëŒ€ 5ê°œ)
  image1 String? // ì´ë¯¸ì§€ URL
  image2 String?
  image3 String?
  image4 String?
  image5 String?
  
  // ğŸ†• ìƒì„¸ í˜ì´ì§€ ì½˜í…ì¸ 
  detailPageContent String? // HTML ë˜ëŠ” Markdown í˜•ì‹

  // âœ… Registry ì—°ê²° (ê°€ì… ì‹œ ë§¤ì¹­)
  registryBizNo String?
  registry      SupplierRegistry? @relation(fields: [registryBizNo], references: [bizNo])

  products    Product[]
  contractRequests ContractRequest[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model BuyerProfile {
  id          String @id @default(cuid())
  companyId   String @unique
  company     Company @relation(fields: [companyId], references: [id])

  employeeCount Int @default(0)
  disabledCount Int @default(0)

  carts            Cart[]
  contractRequests ContractRequest[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Product {
  id          String @id @default(cuid())
  supplierId  String
  supplier    SupplierProfile @relation(fields: [supplierId], references: [id])

  // ê¸°ë³¸ ì •ë³´
  title       String  // ìƒí’ˆëª…
  category    String  // ì¹´í…Œê³ ë¦¬
  summary     String? // í•œì¤„ ìš”ì•½
  description String? // ìƒì„¸ ì„¤ëª…
  
  // ê°€ê²© ë° ìˆ˜ëŸ‰
  price       Int     // ë‹¨ê°€ (KRW)
  unit        String  // ë‹¨ìœ„ ("ì›”", "ê°œ", "ê±´" ë“±)
  minOrderQty Int     @default(1) // ìµœì†Œ ì£¼ë¬¸ ìˆ˜ëŸ‰
  
  // ë‚©í’ˆ ë° ë¦¬ë“œíƒ€ì„
  leadTimeDays Int    @default(7)  // í‰ê·  ë‚©í’ˆ ì†Œìš”ì¼
  deliveryCycle String? // ë‚©í’ˆ ì£¼ê¸° ì„¤ëª…
  
  // ê³„ì•½ ì¡°ê±´ (ë²•ì  ê·¼ê±° í•­ëª©)
  spec        String? // ê·œê²©/ì¬ì§ˆ/ì‚¬ì–‘/ëª…ì„¸
  processDescription String? // ê³µì • ì„¤ëª…
  contractMinMonths Int @default(12) // ìµœì†Œ ê³„ì•½ê¸°ê°„(ì›”) â‰¥12ê°œì›”
  
  // ê°€ê²© ìƒì„¸
  vatIncluded Boolean @default(true) // VAT í¬í•¨ ì—¬ë¶€
  shippingIncluded Boolean @default(false) // ë°°ì†¡ë¹„ í¬í•¨ ì—¬ë¶€
  extraCostNote String? // ì¶”ê°€ ë¹„ìš© ì•ˆë‚´ (ì¸ê±´ë¹„/ìì¬ë¹„ ë¹„ìœ¨ ë“±)
  
  // í’ˆì§ˆ ê¸°ì¤€
  inspectionCriteria String? // ê²€ì‚¬ ê¸°ì¤€
  defectPolicy String? // í•˜ì ì²˜ë¦¬ ë°©ì¹¨
  
  // ê±°ë˜ ì¡°ê±´
  invoiceAvailable Boolean @default(true) // ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ê°€ëŠ¥ ì—¬ë¶€
  quoteLeadTimeDays Int @default(3) // ê²¬ì ì„œ ì œê³µ ì†Œìš”ì¼
  
  // ì´ë¯¸ì§€
  thumbnailUrl String? // ëŒ€í‘œ ì´ë¯¸ì§€
  imageUrls String? // ì¶”ê°€ ì´ë¯¸ì§€ URLë“¤ (JSON array string)
  
  // í‚¤ì›Œë“œ ë° í™œì„±í™”
  keywords String? // ê²€ìƒ‰ í‚¤ì›Œë“œ (ì½¤ë§ˆ êµ¬ë¶„)
  isActive Boolean @default(true)
  
  // ğŸ†• ë¯¼ì› ë°©ì§€ í•„ìˆ˜ í•­ëª© (ì—°ê³„ê³ ìš© ê°ë©´ ë¦¬ìŠ¤í¬ ìµœì†Œí™”)
  // 1. ì§ì ‘ì´í–‰ í™•ì¸
  noSubcontractConfirm Boolean @default(false) // "ë³¸ ë„ê¸‰ì€ ë‹¹ì‚¬ê°€ ì§ì ‘ ìˆ˜í–‰í•˜ë©° í•˜ë„ê¸‰/ì¬í•˜ë„ê¸‰ í•˜ì§€ ì•ŠìŒ" ì²´í¬ (í•„ìˆ˜)
  
  // 2. ì›”ë³„ ì´í–‰ êµ¬ì¡°
  monthlyDeliverySchedule String? // ë‚©í’ˆì£¼ê¸° (ì˜ˆ: "ë§¤ì›” 1íšŒ", "ì£¼ 2íšŒ")
  monthlyBillingBasis String? // ì›”ë³„ ì‚°ì¶œ ê¸°ì¤€ (ì˜ˆ: "ì›”ë³„ ì •ì•¡", "ì›”ë³„ ìˆ˜ëŸ‰Ã—ë‹¨ê°€")
  monthlyBillingDay Int @default(31) // ì›”ë³„ ì²­êµ¬ì¼ (1~31)
  monthlyPaymentDay Int @default(10) // ì›”ë³„ ì§€ê¸‰ì¼ (1~31)
  
  // 3. ì›”ë³„ í™•ì •ê¸ˆì•¡
  monthlyFixedAmount Int? // ì›” í™•ì •ê¸ˆì•¡ (ì›) - ë³€ë™í˜•ì´ë©´ ìµœì†Œ ë³´ìˆ˜(í•˜í•œ)
  monthlyAmountNote String? // ì›”ë³„ ê¸ˆì•¡ ì„¤ëª… (ì˜ˆ: "ì›” ìµœì†Œ ë³´ìˆ˜", "ë³€ë™í˜•")
  
  // 4. ë³´ìˆ˜ ì‚°ì¶œë‚´ì—­ (JSON: {labor: %, material: %, other: %} ë˜ëŠ” ê¸ˆì•¡)
  costBreakdownJson String? // ë…¸ë¬´ë¹„/ì¬ë£Œë¹„/ê¸°íƒ€ ë¹„ìœ¨ ë˜ëŠ” ê¸ˆì•¡ (JSON ë¬¸ìì—´)
  
  // 5. ì´í–‰ì¦ë¹™
  evidenceMethods String? // ì¦ë¹™ ë°©ì‹ (JSON array: ["ë‚©í’ˆí™•ì¸ì„œ", "ê²€ìˆ˜ì„œëª…", "ì „ìê²€ìˆ˜", "ì‚¬ì§„", "ì„¸ê¸ˆê³„ì‚°ì„œ"])
  invoiceIssueConfirmed Boolean @default(false) // ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ê°€ëŠ¥ í™•ì¸ (í•„ìˆ˜)
  receiptNote String? // ì˜ìˆ˜ì¦/ì´ì²´ì¦ë¹™ ì•ˆë‚´ (ì„ íƒ)
  
  // 6. ê³„ì•½ê¸°ê°„ (ê¸°ì¡´ contractMinMonths í™œìš©, ìµœì†Œ 12ê°œì›” ê°•ì œ)

  cartItems   CartItem[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Cart {
  id        String @id @default(cuid())
  buyerId   String @unique
  buyer     BuyerProfile @relation(fields: [buyerId], references: [id])
  items     CartItem[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CartItem {
  id        String @id @default(cuid())
  cartId    String
  cart      Cart @relation(fields: [cartId], references: [id], onDelete: Cascade)
  productId String
  product   Product @relation(fields: [productId], references: [id])
  qty       Int
  createdAt DateTime @default(now())

  @@unique([cartId, productId])
}

model ContractRequest {
  id          String @id @default(cuid())
  buyerId     String
  buyer       BuyerProfile @relation(fields: [buyerId], references: [id])
  supplierId  String
  supplier    SupplierProfile @relation(fields: [supplierId], references: [id])

  totalAmount Int
  status      String @default("REQUESTED") // "REQUESTED" | "QUOTED" | "AGREED" | "IN_PROGRESS" | "DELIVERED" | "COMPLETED" | "CANCELED"
  requirements String?
  durationMonths Int? // ê³„ì•½ê¸°ê°„(ì›”)
  
  // ğŸ†• ê°ë©´ ë¦¬ìŠ¤í¬ í™•ì¸ (ì²´í¬ì•„ì›ƒ ì‹œ í•„ìˆ˜)
  buyerAcceptedRiskDisclosure Boolean @default(false) // êµ¬ë§¤ìê°€ ê°ë©´ ë¦¬ìŠ¤í¬ í™•ì¸ ì²´í¬ë°•ìŠ¤ì— ë™ì˜í–ˆëŠ”ì§€

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ì—°ë„ë³„ ì˜ë¬´ê³ ìš©ë¥  ë° ë¶€ë‹´ê¸ˆ ì„¤ì •
model YearSetting {
  year              Int @id
  privateQuotaRate  Float  // ì˜ˆ: 0.031 (3.1%)
  publicQuotaRate   Float  // ì˜ˆ: 0.038 (3.8%)
  baseLevyAmount    Int    // ë¶€ë‹´ê¸°ì´ˆì•¡(ì„¤ì •ê°’)
  maxReductionRate  Float  @default(0.9) // 90%
  maxReductionByContract Float @default(0.5) // ë„ê¸‰ì•¡ 50%
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// CMS ì½˜í…ì¸  í˜ì´ì§€
model Page {
  slug      String @id
  title     String
  contentMd String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
