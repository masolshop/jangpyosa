generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                String   @id @default(cuid())
  phone             String   @unique
  username          String?  @unique       // ğŸ†• ê¸°ì—… ë¡œê·¸ì¸ ID (ì˜ë¬¸+ìˆ«ì)
  email             String?
  passwordHash      String
  name              String
  role              String                 // BUYER, SUPPLIER, AGENT, SUPER_ADMIN, EMPLOYEE
  branchId          String?
  refCode           String?  @unique
  referredById      String?
  
  // ğŸ†• ê¸°ì—… ì†Œì† ì •ë³´ (ownerUserId ëŒ€ì‹  companyId ì‚¬ìš©)
  companyId         String?                // ì†Œì† íšŒì‚¬ ID
  isCompanyOwner    Boolean  @default(false) // íšŒì‚¬ ìµœì´ˆ ìƒì„±ì ì—¬ë¶€
  
  // ğŸ†• ê¸°ì—… ë‹´ë‹¹ì ì •ë³´ (SUPPLIER, BUYER ì „ìš©)
  managerName       String?                // ë‹´ë‹¹ì ì„±í•¨
  managerTitle      String?                // ë‹´ë‹¹ì ì§í•¨
  managerEmail      String?                // ë‹´ë‹¹ì ì´ë©”ì¼
  managerPhone      String?                // ë‹´ë‹¹ì í•¸ë“œí° (ì•Œë¦¼í†¡ìš©)
  
  // ğŸ†• ì§ì› ê³„ì • ì „ìš© í•„ë“œ (EMPLOYEE ì—­í• )
  employeeId        String?  @unique       // DisabledEmployee ID (ë§¤ì¹­ìš©)
  companyBizNo      String?                // ì†Œì† ê¸°ì—… ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸
  
  // ğŸ†• ê°œì¸ì •ë³´ ë™ì˜
  privacyAgreed     Boolean  @default(false)
  privacyAgreedAt   DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  companyType       String?
  company           Company? @relation("CompanyMembers", fields: [companyId], references: [id])
  ownedCompany      Company? @relation("CompanyOwner") // ownerUserId ê´€ê³„ ìœ ì§€
  referredBy        User?    @relation("Referrals", fields: [referredById], references: [id])
  referrals         User[]   @relation("Referrals")
  branch            Branch?  @relation(fields: [branchId], references: [id])
  sentInvitations   TeamInvitation[] @relation("InvitationSender")
  
  @@index([companyId])
  @@index([isCompanyOwner])
}

model Branch {
  id        String   @id @default(cuid())
  name      String   @unique
  code      String   @unique
  region    String?
  address   String?
  phone     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  agents    User[]
}

model Company {
  id              String           @id @default(cuid())
  name            String
  bizNo           String           @unique
  representative  String?
  type            String
  buyerType       String?          // ğŸ†• BUYER ì „ìš©: PRIVATE_COMPANY, PUBLIC_INSTITUTION, GOVERNMENT
  isVerified      Boolean          @default(false)
  apickData       String?
  ownerUserId     String           @unique      // ğŸ†• ê¸°ì¡´ í•„ë“œ ìœ ì§€ (í˜¸í™˜ì„±)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  members         User[]           @relation("CompanyMembers") // ğŸ†• 1:N ê´€ê³„ (íšŒì‚¬ì— ì†Œì†ëœ ëª¨ë“  ë‹´ë‹¹ì)
  ownerUser       User             @relation("CompanyOwner", fields: [ownerUserId], references: [id])
  buyerProfile    BuyerProfile?
  supplierProfile SupplierProfile?
  invitations     TeamInvitation[] // ğŸ†• ì´ˆëŒ€ ì½”ë“œ ëª©ë¡
  announcements   CompanyAnnouncement[] // ğŸ†• íšŒì‚¬ ê³µì§€ì‚¬í•­
  workOrders      WorkOrder[]      // ğŸ†• ì—…ë¬´ì§€ì‹œ ëª©ë¡
  activityLogs    ActivityLog[]    // ğŸ†• í™œë™ ë¡œê·¸
}

model SupplierRegistry {
  id              String            @id @default(cuid())
  certNo          String?
  name            String
  bizNo           String            @unique
  region          String?
  representative  String?
  address         String?
  certDate        String?
  contactTel      String?
  industry        String?
  companyType     String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  claimedProfiles SupplierProfile[]
}

model SupplierProfile {
  id                  String            @id @default(cuid())
  companyId           String            @unique
  region              String?
  industry            String?
  contactName         String?
  contactTel          String?
  approved            Boolean           @default(false)
  contractDescription String?
  minContractAmount   Int?
  maxContractAmount   Int?
  image1              String?
  image2              String?
  image3              String?
  image4              String?
  image5              String?
  detailPageContent   String?
  registryBizNo       String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  contractRequests    ContractRequest[]
  products            Product[]
  contracts           Contract[]        // ë„ê¸‰ê³„ì•½ ëª©ë¡ ì¶”ê°€
  registry            SupplierRegistry? @relation(fields: [registryBizNo], references: [bizNo])
  company             Company           @relation(fields: [companyId], references: [id])
}

model BuyerProfile {
  id                  String                 @id @default(cuid())
  companyId           String                 @unique
  employeeCount       Int                    @default(0)
  disabledCount       Int                    @default(0)
  yearlyEmployeesJson String?
  hasLevyExemption    Boolean                @default(false)  // ğŸ†• ë¶€ë‹´ê¸ˆ ë©´ì œ ì—¬ë¶€ (í˜„ì¬ëŠ” ì‚¬ìš© ì•ˆ í•¨, ëª¨ë‘ ë¶€ë‹´ê¸ˆ ë¶€ê³¼)
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt
  company             Company                @relation(fields: [companyId], references: [id])
  carts               Cart?
  contractRequests    ContractRequest[]
  disabledEmployees   DisabledEmployee[]
  calculations        Calculation[]
  contracts           Contract[]             // ë„ê¸‰ê³„ì•½ ëª©ë¡ ì¶”ê°€
  monthlyData         MonthlyEmployeeData[]  // ì›”ë³„ ë°ì´í„° ì¶”ê°€
}

// ì›”ë³„ ê³ ìš© ë°ì´í„° (ì •ë°€ ê³„ì‚°)
model MonthlyEmployeeData {
  id                    String       @id @default(cuid())
  buyerId               String
  year                  Int
  month                 Int
  
  // ì…ë ¥ ë°ì´í„°
  totalEmployeeCount    Int          @default(0)  // ìƒì‹œê·¼ë¡œì ìˆ˜ (ìˆ˜ë™ ì…ë ¥)
  
  // ìë™ ê³„ì‚° ë°ì´í„°
  disabledCount         Int          @default(0)  // ì¥ì• ì¸ ìˆ˜ (ìë™)
  recognizedCount       Float        @default(0)  // ì¸ì • ì¥ì• ì¸ ìˆ˜ (ì¤‘ì¦ 2ë°° í¬í•¨)
  obligatedCount        Int          @default(0)  // ì˜ë¬´ê³ ìš©ì¸ì› (ìë™)
  shortfallCount        Int          @default(0)  // ë¯¸ë‹¬ ì¸ì›
  surplusCount          Float        @default(0)  // ì´ˆê³¼ ì¸ì›
  
  // ê²°ê³¼
  levy                  Int          @default(0)  // ë¶€ë‹´ê¸ˆ (ì›)
  incentive             Int          @default(0)  // ì¥ë ¤ê¸ˆ (ì›)
  netAmount             Int          @default(0)  // ìˆœì•¡ (ì¥ë ¤ê¸ˆ - ë¶€ë‹´ê¸ˆ)
  
  // ìƒì„¸ ë‚´ì—­ (JSON)
  detailJson            String?      // ì§ì›ë³„ ìƒì„¸ ê³„ì‚° ë‚´ì—­
  
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
  
  buyer                 BuyerProfile @relation(fields: [buyerId], references: [id], onDelete: Cascade)
  
  @@unique([buyerId, year, month])
  @@index([buyerId, year])
}

model Product {
  id                      String          @id @default(cuid())
  supplierId              String
  title                   String
  category                String
  summary                 String?
  description             String?
  price                   Int
  unit                    String
  minOrderQty             Int             @default(1)
  leadTimeDays            Int             @default(7)
  deliveryCycle           String?
  spec                    String?
  processDescription      String?
  contractMinMonths       Int             @default(12)
  vatIncluded             Boolean         @default(true)
  shippingIncluded        Boolean         @default(false)
  extraCostNote           String?
  inspectionCriteria      String?
  defectPolicy            String?
  invoiceAvailable        Boolean         @default(true)
  quoteLeadTimeDays       Int             @default(3)
  thumbnailUrl            String?
  imageUrls               String?
  keywords                String?
  isActive                Boolean         @default(true)
  noSubcontractConfirm    Boolean         @default(false)
  monthlyDeliverySchedule String?
  monthlyBillingBasis     String?
  monthlyBillingDay       Int             @default(31)
  monthlyPaymentDay       Int             @default(10)
  monthlyFixedAmount      Int?
  monthlyAmountNote       String?
  costBreakdownJson       String?
  evidenceMethods         String?
  invoiceIssueConfirmed   Boolean         @default(false)
  receiptNote             String?
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
  cartItems               CartItem[]
  supplier                SupplierProfile @relation(fields: [supplierId], references: [id])
}

model Cart {
  id        String       @id @default(cuid())
  buyerId   String       @unique
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  buyer     BuyerProfile @relation(fields: [buyerId], references: [id])
  items     CartItem[]
}

model CartItem {
  id        String   @id @default(cuid())
  cartId    String
  productId String
  qty       Int
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id])
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)

  @@unique([cartId, productId])
}

model ContractRequest {
  id                          String          @id @default(cuid())
  buyerId                     String
  supplierId                  String
  totalAmount                 Int
  status                      String          @default("REQUESTED")
  requirements                String?
  durationMonths              Int?
  buyerAcceptedRiskDisclosure Boolean         @default(false)
  createdAt                   DateTime        @default(now())
  updatedAt                   DateTime        @updatedAt
  supplier                    SupplierProfile @relation(fields: [supplierId], references: [id])
  buyer                       BuyerProfile    @relation(fields: [buyerId], references: [id])
}

model YearSetting {
  year                   Int      @id @default(autoincrement())
  privateQuotaRate       Float
  publicQuotaRate        Float
  baseLevyAmount         Int
  maxReductionRate       Float    @default(0.9)
  maxReductionByContract Float    @default(0.5)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

model Page {
  slug      String   @id
  title     String
  contentMd String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DisabledEmployee {
  id                     String             @id @default(cuid())
  buyerId                String
  name                   String
  registrationNumber     String?
  disabilityType         String
  disabilityGrade        String?
  severity               String
  gender                 String
  birthDate              DateTime?          // ìƒë…„ì›”ì¼ ì¶”ê°€ (ì—°ë ¹ë³„ ì¥ë ¤ê¸ˆ ê³„ì‚°ìš©)
  hireDate               DateTime
  resignDate             DateTime?
  monthlySalary          Int
  hasEmploymentInsurance Boolean            @default(true)
  meetsMinimumWage       Boolean            @default(true)
  workHoursPerWeek       Int?               // ì£¼ë‹¹ ê·¼ë¬´ì‹œê°„ (í˜¸í™˜ì„± ìœ ì§€)
  monthlyWorkHours       Int?               // ì›” ê·¼ë¡œì‹œê°„ (ë©”ì¸ í•„ë“œ)
  workType               String             @default("OFFICE") // ê·¼ë¬´í˜•íƒœ: OFFICE, REMOTE, HYBRID
  memo                   String?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  buyer                  BuyerProfile       @relation(fields: [buyerId], references: [id], onDelete: Cascade)
  attendanceRecords      AttendanceRecord[]

  @@index([buyerId, resignDate])
}

model Calculation {
  id         String       @id @default(cuid())
  buyerId    String
  year       Int
  month      Int?
  type       String
  resultJson String
  createdAt  DateTime     @default(now())
  buyer      BuyerProfile @relation(fields: [buyerId], references: [id], onDelete: Cascade)

  @@index([buyerId, year, month, type])
}

// ë„ê¸‰ê³„ì•½ì„œ (ë§ˆìŠ¤í„°)
model Contract {
  id                    String              @id @default(cuid())
  contractNo            String              @unique // ê³„ì•½ë²ˆí˜¸ (ì˜ˆ: CT-2026-0001)
  buyerId               String
  supplierId            String
  contractName          String              // ê³„ì•½ëª…
  startDate             DateTime            // ê³„ì•½ ì‹œì‘ì¼
  endDate               DateTime            // ê³„ì•½ ì¢…ë£Œì¼
  totalAmount           Int                 // ì´ ê³„ì•½ê¸ˆì•¡
  monthlyAmount         Int?                // ì›” ë‹¨ìœ„ ê¸ˆì•¡ (ê³ ì •ì¸ ê²½ìš°)
  status                String              @default("ACTIVE") // ACTIVE, SUSPENDED, TERMINATED, COMPLETED
  paymentTerms          String?             // ê²°ì œ ì¡°ê±´
  contractFileUrl       String?             // ê³„ì•½ì„œ íŒŒì¼ URL
  memo                  String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  buyer                 BuyerProfile        @relation(fields: [buyerId], references: [id])
  supplier              SupplierProfile     @relation(fields: [supplierId], references: [id])
  monthlyPerformances   MonthlyPerformance[]
  
  @@index([buyerId, status])
  @@index([supplierId, status])
  @@index([startDate, endDate])
}

// ì›”ë³„ ê³„ì•½ ì´í–‰ ë‚´ì—­
model MonthlyPerformance {
  id                   String    @id @default(cuid())
  contractId           String
  year                 Int       // ì—°ë„ (2026)
  month                Int       // ì›” (1-12)
  plannedAmount        Int       // ê³„íšê¸ˆì•¡ (ë‹¹ì›” ì˜ˆì •ì•¡)
  actualAmount         Int?      // ì‹¤ì œê¸ˆì•¡ (ì‹¤ì œ ì´í–‰ì•¡)
  performanceRate      Float?    // ì´í–‰ë¥  (%)
  description          String?   // ì´í–‰ ë‚´ì—­ ì„¤ëª…
  evidenceFileUrls     String?   // ì¦ë¹™ìë£Œ URL (JSON array)
  inspectionStatus     String    @default("PENDING") // PENDING, PASSED, FAILED, WAIVED
  inspectionDate       DateTime? // ê²€ìˆ˜ì¼
  inspectionNotes      String?   // ê²€ìˆ˜ ë©”ëª¨
  paymentStatus        String    @default("UNPAID") // UNPAID, PARTIAL, PAID, OVERDUE
  paymentAmount        Int?      // ì‹¤ì œ ì§€ê¸‰ì•¡
  paymentDate          DateTime? // ì§€ê¸‰ì¼
  paymentMethod        String?   // ì§€ê¸‰ ë°©ë²• (ê³„ì¢Œì´ì²´, ì–´ìŒ ë“±)
  paymentReference     String?   // ì§€ê¸‰ ì°¸ì¡°ë²ˆí˜¸
  invoiceNo            String?   // ì„¸ê¸ˆê³„ì‚°ì„œ ë²ˆí˜¸
  invoiceDate          DateTime? // ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ì¼
  invoiceFileUrl       String?   // ì„¸ê¸ˆê³„ì‚°ì„œ íŒŒì¼ URL
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  contract             Contract  @relation(fields: [contractId], references: [id], onDelete: Cascade)
  
  @@unique([contractId, year, month])
  @@index([contractId, year, month])
  @@index([inspectionStatus, paymentStatus])
}

// ê²°ì œ ì´ë ¥ (ìƒì„¸ ë¡œê·¸)
model PaymentHistory {
  id              String    @id @default(cuid())
  performanceId   String    // MonthlyPerformance ID
  amount          Int       // ê²°ì œ ê¸ˆì•¡
  paymentDate     DateTime  // ê²°ì œì¼
  paymentMethod   String    // ê²°ì œ ë°©ë²•
  reference       String?   // ì°¸ì¡°ë²ˆí˜¸ (ê±°ë˜ë²ˆí˜¸ ë“±)
  status          String    @default("COMPLETED") // COMPLETED, CANCELLED, REFUNDED
  memo            String?
  createdBy       String?   // ì²˜ë¦¬ì User ID
  createdAt       DateTime  @default(now())
  
  @@index([performanceId])
  @@index([paymentDate])
}

// ì¶œí‡´ê·¼ ê¸°ë¡
model AttendanceRecord {
  id           String           @id @default(cuid())
  employeeId   String           // DisabledEmployee ID
  date         String           // YYYY-MM-DD í˜•ì‹
  workType     String           // OFFICE (íšŒì‚¬ ì¶œê·¼), REMOTE (ì¬íƒ ê·¼ë¬´)
  clockIn      String?          // ì¶œê·¼ ì‹œê°„ (HH:MM:SS)
  clockOut     String?          // í‡´ê·¼ ì‹œê°„ (HH:MM:SS)
  workHours    Float?           // ê·¼ë¬´ ì‹œê°„ (ì‹œê°„ ë‹¨ìœ„, ì†Œìˆ˜ì  2ìë¦¬)
  location     String?          // GPS ì¢Œí‘œ ë˜ëŠ” ìœ„ì¹˜ ì •ë³´ (ì„ íƒ)
  note         String?          // ë©”ëª¨
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  employee     DisabledEmployee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  @@unique([employeeId, date])
  @@index([employeeId, date])
  @@index([date])
}

// íšŒì‚¬ ê³µì§€ì‚¬í•­
model CompanyAnnouncement {
  id          String                     @id @default(cuid())
  companyId   String                     // Company ID (ë°”ì´ì–´ íšŒì‚¬)
  buyerId     String                     // BuyerProfile ID
  title       String                     // ê³µì§€ ì œëª©
  content     String                     // ê³µì§€ ë‚´ìš©
  priority    String                     @default("NORMAL") // URGENT, NORMAL, LOW
  isActive    Boolean                    @default(true)
  createdById String                     // ì‘ì„±ì User ID
  createdAt   DateTime                   @default(now())
  updatedAt   DateTime                   @updatedAt
  company     Company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  readLogs    AnnouncementReadLog[]
  
  @@index([companyId, isActive])
  @@index([buyerId, isActive])
  @@index([createdAt])
}

// ê³µì§€ ì½ìŒ ê¸°ë¡
model AnnouncementReadLog {
  id              String              @id @default(cuid())
  announcementId  String
  employeeId      String              // DisabledEmployee ID
  userId          String              // User ID (ì§ì› ê³„ì •)
  readAt          DateTime            @default(now())
  announcement    CompanyAnnouncement @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  
  @@unique([announcementId, employeeId])
  @@index([announcementId])
  @@index([employeeId])
  @@index([userId])
}

// íŒ€ì› ì´ˆëŒ€ ì½”ë“œ
model TeamInvitation {
  id              String    @id @default(cuid())
  companyId       String    // íšŒì‚¬ ID
  inviteCode      String    @unique // ì´ˆëŒ€ ì½”ë“œ (8ìë¦¬ ëœë¤)
  invitedBy       String    // ì´ˆëŒ€í•œ ì‚¬ëŒ User ID
  companyType     String    // BUYER, SUPPLIER
  role            String    // ì´ˆëŒ€ëœ ì‚¬ëŒì˜ ì—­í•  (BUYER, SUPPLIER)
  inviteeName     String?   // ì´ˆëŒ€ë°›ì„ ì‚¬ëŒ ì´ë¦„
  inviteePhone    String?   // ì´ˆëŒ€ë°›ì„ ì‚¬ëŒ í•¸ë“œí°
  expiresAt       DateTime  // ë§Œë£Œì¼ (ìƒì„± í›„ 7ì¼)
  isUsed          Boolean   @default(false) // ì‚¬ìš© ì—¬ë¶€
  usedBy          String?   // ì‚¬ìš©í•œ ì‚¬ëŒ User ID
  usedAt          DateTime? // ì‚¬ìš© ì‹œê°
  createdAt       DateTime  @default(now())
  company         Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  sender          User      @relation("InvitationSender", fields: [invitedBy], references: [id])
  
  @@index([inviteCode])
  @@index([companyId])
  @@index([expiresAt, isUsed])
}

// ğŸ†• í™œë™ ë¡œê·¸ (íŒ€ì›ë“¤ì˜ ëª¨ë“  í™œë™ ê¸°ë¡)
model ActivityLog {
  id          String   @id @default(cuid())
  companyId   String   // íšŒì‚¬ ID
  userId      String   // í–‰ë™í•œ ì‚¬ëŒ User ID
  userName    String   // í–‰ë™í•œ ì‚¬ëŒ ì´ë¦„ (ìŠ¤ëƒ…ìƒ·)
  action      String   // CREATE, UPDATE, DELETE, LOGIN, LOGOUT, INVITE, etc.
  targetType  String   // EMPLOYEE, ANNOUNCEMENT, TEAM_MEMBER, COMPANY, MONTHLY_DATA, etc.
  targetId    String?  // ëŒ€ìƒ ID (optional)
  targetName  String?  // ëŒ€ìƒ ì´ë¦„ (ìŠ¤ëƒ…ìƒ·)
  details     String?  // ì¶”ê°€ ì •ë³´ (JSON)
  ipAddress   String?  // IP ì£¼ì†Œ
  createdAt   DateTime @default(now())
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@index([companyId, createdAt])
  @@index([userId, createdAt])
  @@index([action])
  @@index([targetType, targetId])
}

// ê²¬ì  ë¬¸ì˜ (ì¥í‘œì‚¬ë‹·ì»´ìœ¼ë¡œ ì „ë‹¬)
model QuoteInquiry {
  id                String   @id @default(cuid())
  productId         String?  // ê´€ë ¨ ìƒí’ˆ ID (ì„ íƒ)
  companyName       String   // íšŒì‚¬ëª…
  contactName       String   // ë‹´ë‹¹ìëª…
  contactPhone      String   // ì—°ë½ì²˜
  contactEmail      String?  // ì´ë©”ì¼
  bizNo             String?  // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸
  category          String   // ìƒí’ˆ ì¹´í…Œê³ ë¦¬
  productName       String   // ìƒí’ˆëª…
  quantity          Int?     // ìˆ˜ëŸ‰
  budget            String?  // ì˜ˆì‚° ë²”ìœ„
  timeline          String?  // ë‚©ê¸° í¬ë§ì¼
  requirements      String?  // ìƒì„¸ ìš”êµ¬ì‚¬í•­
  attachmentUrls    String?  // ì²¨ë¶€íŒŒì¼ URL (JSON array)
  status            String   @default("PENDING") // PENDING, IN_PROGRESS, QUOTED, COMPLETED, CANCELLED
  adminNote         String?  // ê´€ë¦¬ì ë©”ëª¨
  respondedAt       DateTime? // ì‘ë‹µì¼ì‹œ
  respondedBy       String?  // ì‘ë‹µì User ID
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([status, createdAt])
  @@index([category])
  @@index([contactPhone])
}

// ì—…ë¬´ì§€ì‹œ (ë‹¨ì²´ ë˜ëŠ” ê°œì¸ ë°œì†¡, ìŒì„± ì²¨ë¶€ ê°€ëŠ¥)
model WorkOrder {
  id              String                @id @default(cuid())
  companyId       String                // Company ID (ë°”ì´ì–´ íšŒì‚¬)
  buyerId         String                // BuyerProfile ID
  title           String                // ì§€ì‹œ ì œëª©
  content         String                // ì§€ì‹œ ë‚´ìš© (descriptionìœ¼ë¡œ ë³€ê²½ ì¶”ì²œ)
  description     String?               // ğŸ†• ìƒì„¸ ì„¤ëª… (contentì™€ ë™ì¼í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥)
  targetType      String                // ëŒ€ìƒ íƒ€ì…: ALL (ì „ì²´), GROUP (ê·¸ë£¹), INDIVIDUAL (ê°œì¸)
  targetEmployees String?               // JSON array: ëŒ€ìƒ ì§ì› ID ëª©ë¡ (targetTypeì´ GROUP ë˜ëŠ” INDIVIDUALì¼ ë•Œ)
  priority        String                @default("NORMAL") // URGENT, HIGH, NORMAL, LOW
  status          String                @default("PENDING") // ğŸ†• PENDING, IN_PROGRESS, COMPLETED, CANCELLED
  dueDate         DateTime?             // ì™„ë£Œ ê¸°í•œ
  attachmentUrls  String?               // ğŸ†• ì²¨ë¶€íŒŒì¼ URL (JSON array)
  audioFileUrl    String?               // ìŒì„± íŒŒì¼ URL (ì„ íƒ)
  audioFileName   String?               // ìŒì„± íŒŒì¼ ì´ë¦„
  audioDuration   Int?                  // ìŒì„± íŒŒì¼ ê¸¸ì´ (ì´ˆ)
  isActive        Boolean               @default(true)
  createdById     String                // ì‘ì„±ì User ID
  createdByName   String                // ì‘ì„±ì ì´ë¦„ (ìŠ¤ëƒ…ìƒ·)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  company         Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  recipients      WorkOrderRecipient[]  // ğŸ†• ìˆ˜ì‹ ì ëª©ë¡ (ìƒíƒœ ê´€ë¦¬)
  
  @@index([companyId, isActive])
  @@index([buyerId, isActive])
  @@index([createdAt])
  @@index([priority, dueDate])
  @@index([status])
}

// ğŸ†• ì—…ë¬´ì§€ì‹œ ìˆ˜ì‹ ì (ê°œë³„ ìƒíƒœ ê´€ë¦¬)
model WorkOrderRecipient {
  id                String      @id @default(cuid())
  workOrderId       String
  employeeId        String      // DisabledEmployee ID
  userId            String      // User ID (ì§ì› ê³„ì •)
  status            String      @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, REJECTED
  startedAt         DateTime?   // ì‹œì‘ ì‹œê°„
  completedAt       DateTime?   // ì™„ë£Œ ì‹œê°„
  completionReport  String?     // ì™„ë£Œ ë³´ê³ ì„œ
  rejectionReason   String?     // ê±°ë¶€ ì‚¬ìœ 
  adminApproval     String      @default("PENDING") // ğŸ†• PENDING, APPROVED, REJECTED (ê´€ë¦¬ì ìŠ¹ì¸)
  adminNote         String?     // ğŸ†• ê´€ë¦¬ì ë©”ëª¨
  approvedAt        DateTime?   // ğŸ†• ìŠ¹ì¸ ì‹œê°„
  approvedBy        String?     // ğŸ†• ìŠ¹ì¸í•œ ê´€ë¦¬ì User ID
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  workOrder         WorkOrder   @relation(fields: [workOrderId], references: [id], onDelete: Cascade)
  
  @@unique([workOrderId, employeeId])
  @@index([workOrderId])
  @@index([employeeId])
  @@index([userId])
  @@index([status])
  @@index([adminApproval])
}

// ì—…ë¬´ì§€ì‹œ í™•ì¸ ê¸°ë¡ (ë ˆê±°ì‹œ - ì´ì œ WorkOrderRecipientë¡œ ëŒ€ì²´)
model WorkOrderConfirmation {
  id              String      @id @default(cuid())
  workOrderId     String
  employeeId      String      // DisabledEmployee ID
  userId          String      // User ID (ì§ì› ê³„ì •)
  confirmedAt     DateTime    @default(now())
  note            String?     // í™•ì¸ ë©”ëª¨ (ì„ íƒ)
  
  @@unique([workOrderId, employeeId])
  @@index([workOrderId])
  @@index([employeeId])
  @@index([userId])
}

// ì‹¤ì‹œê°„ ì•Œë¦¼
model Notification {
  id          String    @id @default(cuid())
  userId      String    // ìˆ˜ì‹ ì User ID
  type        String    // ANNOUNCEMENT, WORK_ORDER, ATTENDANCE, SYSTEM, etc.
  title       String    // ì•Œë¦¼ ì œëª©
  message     String    // ì•Œë¦¼ ë‚´ìš©
  link        String?   // ê´€ë ¨ ë§í¬ (ì„ íƒ)
  data        String?   // ì¶”ê°€ ë°ì´í„° (JSON)
  read        Boolean   @default(false)
  readAt      DateTime? // ì½ì€ ì‹œê°
  createdAt   DateTime  @default(now())
  
  @@index([userId, read, createdAt])
  @@index([userId, createdAt])
  @@index([type])
}
