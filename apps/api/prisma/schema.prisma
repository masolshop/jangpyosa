generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  name         String
  phone        String?
  role         String   // "SUPER_ADMIN" | "BRANCH_ADMIN" | "AGENT" | "BUYER" | "SUPPLIER"
  refCode      String?  @unique // ì¶”ì²œì½”ë“œ(ì˜ì—…ì) - ìœ ë‹ˆí¬ ì¶”ê°€
  referredById String?  // ê°€ì… ì‹œ ì¶”ì²œì
  referredBy   User?    @relation("Referrals", fields: [referredById], references: [id])
  referrals    User[]   @relation("Referrals")
  company      Company?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Company {
  id          String      @id @default(cuid())
  name        String
  bizNo       String      @unique
  type        String      // "PRIVATE" | "PUBLIC"
  isVerified  Boolean     @default(false)
  ownerUserId String      @unique
  ownerUser   User        @relation(fields: [ownerUserId], references: [id])

  supplierProfile SupplierProfile?
  buyerProfile    BuyerProfile?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// â­ 830ê°œ ì—…ì²´ ì—‘ì…€ ì—…ë¡œë“œìš© ë ˆì§€ìŠ¤íŠ¸ë¦¬ í…Œì´ë¸” (ìœ ì € ì—†ì´ë„ ì €ì¥ ê°€ëŠ¥)
model SupplierRegistry {
  id         String   @id @default(cuid())
  
  // ê¸°ë³¸ ì •ë³´ (ì—‘ì…€ì—ì„œ ê°€ì ¸ì˜´)
  certNo     String?  // ì¸ì¦ë²ˆí˜¸
  name       String   // ì‚¬ì—…ì²´ëª…
  bizNo      String   @unique // ì‚¬ì—…ìë²ˆí˜¸
  region     String?  // ê´€í• ì§€ì‚¬/ì†Œì¬ì§€
  representative String? // ëŒ€í‘œì
  address    String?  // ì†Œì¬ì§€
  certDate   String?  // ì¸ì¦ì¼ì
  contactTel String?  // ì „í™”ë²ˆí˜¸
  industry   String?  // ì—…ì¢… ë° ì£¼ìš”ìƒì‚°í’ˆ
  companyType String? // êµ¬ë¶„ (ì¼ë°˜/ìíšŒì‚¬)
  
  // âœ… Claim ê´€ê³„ ì„¤ì •
  claimedProfiles SupplierProfile[]
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model SupplierProfile {
  id          String @id @default(cuid())
  companyId   String @unique
  company     Company @relation(fields: [companyId], references: [id])

  region      String?
  industry    String?
  contactName String?
  contactTel  String?
  approved    Boolean @default(false)
  
  // ğŸ†• ë„ê¸‰ê³„ì•½ ì •ë³´
  contractDescription String? // ë„ê¸‰ê³„ì•½ ë°©ë²• ë° ì¡°ê±´ ì„¤ëª…
  minContractAmount   Int?    // ìµœì†Œ ë„ê¸‰ê³„ì•½ ê°€ëŠ¥ ê¸ˆì•¡ (KRW)
  maxContractAmount   Int?    // ìµœëŒ€ ë„ê¸‰ê³„ì•½ ê°€ëŠ¥ ê¸ˆì•¡ (KRW)
  
  // ğŸ†• ëŒ€í‘œ ì´ë¯¸ì§€ (ìµœëŒ€ 5ê°œ)
  image1 String? // ì´ë¯¸ì§€ URL
  image2 String?
  image3 String?
  image4 String?
  image5 String?
  
  // ğŸ†• ìƒì„¸ í˜ì´ì§€ ì½˜í…ì¸ 
  detailPageContent String? // HTML ë˜ëŠ” Markdown í˜•ì‹

  // âœ… Registry ì—°ê²° (ê°€ì… ì‹œ ë§¤ì¹­)
  registryBizNo String?
  registry      SupplierRegistry? @relation(fields: [registryBizNo], references: [bizNo])

  products    Product[]
  contractRequests ContractRequest[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model BuyerProfile {
  id          String @id @default(cuid())
  companyId   String @unique
  company     Company @relation(fields: [companyId], references: [id])

  employeeCount Int @default(0)
  disabledCount Int @default(0)

  carts            Cart[]
  contractRequests ContractRequest[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Product {
  id          String @id @default(cuid())
  supplierId  String
  supplier    SupplierProfile @relation(fields: [supplierId], references: [id])

  title       String
  category    String
  price       Int     // KRW
  unit        String  // "ì›”", "ê°œ", "ê±´" ë“±
  minOrderQty Int     @default(1)
  leadTimeDays Int    @default(7)
  isActive    Boolean @default(true)

  cartItems   CartItem[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Cart {
  id        String @id @default(cuid())
  buyerId   String @unique
  buyer     BuyerProfile @relation(fields: [buyerId], references: [id])
  items     CartItem[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CartItem {
  id        String @id @default(cuid())
  cartId    String
  cart      Cart @relation(fields: [cartId], references: [id], onDelete: Cascade)
  productId String
  product   Product @relation(fields: [productId], references: [id])
  qty       Int
  createdAt DateTime @default(now())

  @@unique([cartId, productId])
}

model ContractRequest {
  id          String @id @default(cuid())
  buyerId     String
  buyer       BuyerProfile @relation(fields: [buyerId], references: [id])
  supplierId  String
  supplier    SupplierProfile @relation(fields: [supplierId], references: [id])

  totalAmount Int
  status      String @default("REQUESTED") // "REQUESTED" | "QUOTED" | "AGREED" | "IN_PROGRESS" | "DELIVERED" | "COMPLETED" | "CANCELED"
  requirements String?
  durationMonths Int? // ê³„ì•½ê¸°ê°„(ì›”)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ì—°ë„ë³„ ì˜ë¬´ê³ ìš©ë¥  ë° ë¶€ë‹´ê¸ˆ ì„¤ì •
model YearSetting {
  year              Int @id
  privateQuotaRate  Float  // ì˜ˆ: 0.031 (3.1%)
  publicQuotaRate   Float  // ì˜ˆ: 0.038 (3.8%)
  baseLevyAmount    Int    // ë¶€ë‹´ê¸°ì´ˆì•¡(ì„¤ì •ê°’)
  maxReductionRate  Float  @default(0.9) // 90%
  maxReductionByContract Float @default(0.5) // ë„ê¸‰ì•¡ 50%
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// CMS ì½˜í…ì¸  í˜ì´ì§€
model Page {
  slug      String @id
  title     String
  contentMd String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
