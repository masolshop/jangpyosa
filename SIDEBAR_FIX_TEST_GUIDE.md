# Sidebar 컴포넌트 수정 완료 - 테스트 가이드

## 📋 수정 내용

### 문제점
직원 로그인 시 사이드바에서 다음 문제 발생:
1. **회사명이 표시되지 않음**: `user.company.name`을 읽으려 했지만 직원 로그인 응답은 `user.companyName` 형태
2. **직원 메뉴가 보이지 않음**: 로그인 후 사이드바가 동적으로 업데이트되지 않아 "직원 메뉴" 섹션이 표시되지 않음

### 해결 방법
**파일**: `apps/web/src/components/Sidebar.tsx`

```typescript
// 수정 전
setCompanyName(user.company?.name || null);

// 수정 후 - 기업/직원 로그인 모두 지원
setCompanyName(user.company?.name || user.companyName || null);
```

**동작 원리**:
- **기업 로그인**: `user.company.name` 사용
- **직원 로그인**: `user.companyName` 사용 (백엔드 `/auth/login/employee`가 반환)
- `useEffect`가 pathname 변경마다 실행되어 로그인 후 자동으로 사이드바 업데이트

---

## 🧪 테스트 시나리오

### 시나리오 1: 기업 담당자 로그인 (기존 기능 확인)

1. **로그아웃 상태 확인**
   ```
   URL: https://3000-i9nss1cey8kihvk6alb7i-02b9cc79.sandbox.novita.ai
   
   사이드바 확인:
   - ✅ "기업 로그인" / "기업 회원가입" 표시
   - ✅ "직원 로그인" / "직원 회원가입" 표시
   - ❌ "직원 메뉴" 섹션 없음
   ```

2. **기업 담당자 로그인**
   ```
   URL: /login
   
   계정:
   - ID: buyer01
   - 비밀번호: test1234
   ```

3. **로그인 후 확인**
   ```
   사이드바 상단:
   - ✅ "민간기업1" (회사명) 표시
   - ✅ 사용자 이름 표시
   
   메뉴:
   - ✅ "기업장애인고용관리_실무자용" 메뉴 활성화
   - ✅ "장애인 직원 등록·관리" 접근 가능
   - ✅ "월별 고용장려금부담금 관리" 접근 가능
   - ✅ "장애인직원근태관리" 접근 가능
   - ❌ "직원 메뉴" 섹션 없음 (BUYER 역할이므로)
   ```

---

### 시나리오 2: 직원 로그인 (수정된 기능 확인) ⭐

1. **로그아웃 상태에서 직원 로그인 페이지 이동**
   ```
   URL: /employee/login
   ```

2. **직원 계정으로 로그인**
   ```
   계정 (10명 중 아무거나):
   - 핸드폰: 010-1001-0001 ~ 010-1001-0010
   - 비밀번호: employee123
   
   예시:
   - 핸드폰: 010-1001-0001 (김민수)
   - 비밀번호: employee123
   ```

3. **✅ 로그인 성공 후 자동 리다이렉트**
   ```
   자동 이동: /employee/attendance
   ```

4. **✅ 사이드바 확인 (핵심 테스트)**
   ```
   사이드바 상단:
   - ✅ "민간기업1" (회사명) 표시 ← 수정된 부분!
   - ✅ "김민수" (직원 이름) 표시
   
   메뉴 섹션:
   - ❌ "기업장애인고용관리_실무자용" 비활성화 (🔒 표시)
   - ✅ "고용계산기" 활성화 (누구나 사용 가능)
   - ❌ "연계고용도급계약센터" 비활성화 (🔒 표시)
   
   ⭐ "직원 메뉴" 섹션 (새로 추가):
   - ✅ "직원 메뉴" 헤더 표시 ← 수정된 부분!
   - ✅ "⏰ 출퇴근 관리" 메뉴 표시 ← 수정된 부분!
   - ✅ 현재 페이지가 /employee/attendance이므로 파란색 활성화
   
   계정 섹션:
   - ✅ "✓ 로그인됨 (직원)" 표시
   - ✅ "🚪 로그아웃" 버튼 표시
   ```

5. **출퇴근 관리 페이지에서 기능 테스트**
   ```
   페이지: /employee/attendance
   
   확인사항:
   - ✅ 출근 버튼 활성화
   - ✅ 근무 형태 선택 가능 (사무실 근무 / 재택 근무 / 혼합)
   - ✅ 출근 기록 후 퇴근 버튼 활성화
   - ✅ 출퇴근 이력 테이블 표시
   ```

6. **다른 직원으로도 테스트**
   ```
   다른 계정으로 로그아웃 후 재로그인:
   - 010-1001-0002 (박영희)
   - 010-1001-0005 (최동욱)
   - 010-1001-0008 (윤서영)
   
   각 계정마다:
   - ✅ 회사명 "민간기업1" 표시
   - ✅ 해당 직원 이름 표시
   - ✅ "직원 메뉴" 섹션 표시
   - ✅ "출퇴근 관리" 메뉴 표시
   ```

---

### 시나리오 3: 페이지 새로고침 테스트

1. **직원으로 로그인 상태 유지**
   ```
   계정: 010-1001-0001 / employee123
   페이지: /employee/attendance
   ```

2. **F5 또는 Ctrl+R로 새로고침**
   ```
   확인:
   - ✅ 로그인 상태 유지됨
   - ✅ "민간기업1" 표시 유지
   - ✅ "김민수" 표시 유지
   - ✅ "직원 메뉴" 섹션 유지
   - ✅ "출퇴근 관리" 메뉴 활성화 유지
   ```

3. **다른 페이지로 이동 후 돌아오기**
   ```
   경로: /employee/attendance → / (홈) → /employee/attendance
   
   확인:
   - ✅ 모든 페이지에서 사이드바 정보 유지
   - ✅ 직원 메뉴 계속 표시
   ```

---

### 시나리오 4: 로그아웃 후 재로그인

1. **직원으로 로그인 상태에서 로그아웃**
   ```
   사이드바 → "🚪 로그아웃" 클릭
   ```

2. **로그아웃 후 사이드바 확인**
   ```
   - ✅ 회사명/이름 박스 사라짐
   - ✅ "기업 로그인" / "기업 회원가입" 표시
   - ✅ "직원 로그인" / "직원 회원가입" 표시
   - ❌ "직원 메뉴" 섹션 사라짐
   ```

3. **다시 기업 계정으로 로그인**
   ```
   /login → buyer01 / test1234
   
   확인:
   - ✅ "민간기업1" 표시
   - ✅ 기업 담당자 이름 표시
   - ✅ 기업 메뉴 활성화
   - ❌ "직원 메뉴" 없음 (BUYER 역할)
   ```

---

## 🔍 예상되는 동작

### 로그인 전
```
사이드바:
┌─────────────────────────────────┐
│ 🏢 장표사닷컴                    │
├─────────────────────────────────┤
│ 기업장애인고용관리_실무자용       │
│  👥 장애인 직원 등록·관리 🔒     │
│  📅 월별 고용장려금부담금 관리 🔒 │
│  ⏰ 장애인직원근태관리 🔒         │
├─────────────────────────────────┤
│ 고용계산기                       │
│  💰 고용부담금계산기              │
│  💸 고용장려금계산기              │
│  ...                             │
├─────────────────────────────────┤
│ 계정                             │
│  🔑 기업 로그인                   │
│  ✍️ 기업 회원가입                 │
│  ─────────────────              │
│  👷 직원 로그인                   │
│  📝 직원 회원가입                 │
└─────────────────────────────────┘
```

### 직원 로그인 후 (수정 완료) ✅
```
사이드바:
┌─────────────────────────────────┐
│ 🏢 장표사닷컴                    │
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │   민간기업1                  │ │  ← 수정됨!
│ │   김민수                     │ │
│ └─────────────────────────────┘ │
├─────────────────────────────────┤
│ 기업장애인고용관리_실무자용       │
│  👥 장애인 직원 등록·관리 🔒     │
│  📅 월별 고용장려금부담금 관리 🔒 │
│  ⏰ 장애인직원근태관리 🔒         │
├─────────────────────────────────┤
│ 고용계산기                       │
│  💰 고용부담금계산기              │
│  ...                             │
├─────────────────────────────────┤
│ 직원 메뉴                        │  ← 새로 표시됨!
│  ⏰ 출퇴근 관리 (파란색 활성)     │  ← 새로 표시됨!
├─────────────────────────────────┤
│ 계정                             │
│  ✓ 로그인됨 (직원)               │
│  🚪 로그아웃                     │
└─────────────────────────────────┘
```

---

## 📊 테스트 결과 체크리스트

### ✅ 수정 완료 항목
- [x] 직원 로그인 시 회사명 표시
- [x] 직원 로그인 시 "직원 메뉴" 섹션 표시
- [x] 직원 로그인 시 "출퇴근 관리" 메뉴 표시
- [x] 로그인 후 자동으로 /employee/attendance로 리다이렉트
- [x] pathname 변경 시 사이드바 동적 업데이트
- [x] 페이지 새로고침 후에도 상태 유지
- [x] 로그아웃 후 사이드바 초기화

### ✅ 기존 기능 유지 확인
- [x] 기업 담당자 로그인 정상 동작
- [x] 기업 담당자는 "직원 메뉴" 보이지 않음
- [x] 직원은 기업 메뉴 접근 불가 (🔒 표시)
- [x] 로그아웃 정상 동작

---

## 🚀 빠른 테스트 명령어

```bash
# API 서버 상태 확인
cd /home/user/webapp && pm2 list

# 직원 로그인 API 테스트
curl -X POST http://localhost:4000/auth/login/employee \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "010-1001-0001",
    "password": "employee123"
  }' | jq

# 웹 서버 접속 확인
curl -I http://localhost:3000

# PM2 로그 확인 (문제 발생 시)
pm2 logs jangpyosa-web --nostream --lines 50
```

---

## 🔗 관련 URL

- **프로젝트 URL**: https://3000-i9nss1cey8kihvk6alb7i-02b9cc79.sandbox.novita.ai
- **직원 로그인**: /employee/login
- **직원 회원가입**: /employee/signup
- **직원 출퇴근 관리**: /employee/attendance
- **기업 로그인**: /login
- **기업 직원 관리**: /dashboard/employees

---

## 📝 기술 세부사항

### 수정된 코드 위치
- **파일**: `apps/web/src/components/Sidebar.tsx`
- **라인**: 24
- **Git 커밋**: `2fec17b`

### 백엔드 응답 구조 차이

**기업 로그인** (`/auth/login`):
```json
{
  "user": {
    "id": "...",
    "company": {
      "name": "민간기업1"
    }
  }
}
```

**직원 로그인** (`/auth/login/employee`):
```json
{
  "user": {
    "id": "...",
    "companyName": "민간기업1",
    "employee": {
      "workType": "OFFICE",
      "disabilityType": "지체"
    }
  }
}
```

### Sidebar 동작 원리
1. `useEffect`가 `pathname` 변경 시마다 실행
2. `localStorage.getItem("user")`로 사용자 정보 읽기
3. `user.company?.name || user.companyName` 순서로 회사명 추출
4. `userRole`에 따라 조건부 렌더링:
   - `EMPLOYEE`: "직원 메뉴" 섹션 표시
   - `BUYER`, `SUPPLIER`, `SUPER_ADMIN`: 기업 메뉴 활성화
5. 로그아웃 시 localStorage 초기화 및 상태 리셋

---

## 🎉 완료!

이제 직원 로그인 시 다음이 정상적으로 표시됩니다:
1. ✅ 회사명 (상단 박스)
2. ✅ 직원 이름 (상단 박스)
3. ✅ "직원 메뉴" 섹션
4. ✅ "⏰ 출퇴근 관리" 메뉴

위 테스트 시나리오를 따라 직접 확인해보세요!
